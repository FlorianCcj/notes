

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Methodology - Event Sourcing and Domain Driven Design (DDD) &mdash; my_knowledge 0.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Methodology - Comment etre sur de rater ton projet informatique" href="methodology-fail_over.html" />
    <link rel="prev" title="Methodology - Code - Beginner" href="methodology-code-beginner.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> my_knowledge
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../todo/todo-000_wip.html">Todos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ansible/ansible-if.html">Ansible - if</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ansible/ansible-molecule.html">Ansible - Molecule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db/db-mysql-tricks.html">DB - MySQL - Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db/db-neo4j-cypher.html">Db - Neo4j - Cypher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db/db-neo4j-from_sql_to_neo4j.html">Db - Neo4j - From SQL to NEO4J</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db/db-postgres-user_permissions.html">Db - Postgres - User Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../discord/discord-bot-node.html">Discord - Bot - NodeJS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../discord/discord-bot-node-example.html">Discord - Bot - NodeJS - First Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-config.html">Git - gitconfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-crash-course.html">Git - Crash Course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-for_beginner.html">Git - For beginner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-hook.html">Git - Hook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-submodule.html">Git - Multi Repo management (submodule and fork)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../git/git-trics.html">Git - Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/aws-foundations_technical.html">AWS - Foundations Technical</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/cloud_native-security_101.html">Cloud Native - Security 101</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/docker-network.html">Docker - Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/docker-tricks.html">Docker - Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/k8s-deploy-troubleshooting.html">K8S - Deploy - Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/k8s-getting_started.html">k8s - Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/k8s-no_yaml.html">Yaml is optional</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/k8s-observability.html">K8S - Observability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/k8s-security.html">K8S - Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-ansible.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-aws.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-consul.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-docker.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-docker_compose.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-docker_swarm.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-haproxy.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-jenkins.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-jmeter.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-k8s.html">xavki-k8s</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-lxc_lxd.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-mesh.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-netcat.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-terraform.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s/xavki-vagrant.html">Document history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/default_bin.html">Linux - Default bin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/linux-check_port.html">linux - check port</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/linux-debug.html">Linux - debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/linux-history.html">Linux - History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/linux-triks.html">Linux - Triks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/linux-tmux.html">Linux - Tmux</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/linux-vi.html">Linux - Vim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sup/sup-grafana.html">Sup - Grafana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sup/sup-monitoring_with_prometheus.html">Sup - Monitoring with Prometheus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sup/sup-promql.html">Sup - promql</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sup/sup-thanos.html">Sup - Thanos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vault/vault-admin.html">Vault - Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vault/vault-install.html">Vault - Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vault/vault-user.html">Vault - User</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/angular-async_await.html">Angular - async await</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/angular-environment.html">Angular - Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/angular-ngclass_and_ngstyle.html">Angular - Ngclass and Ngstyle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/angular-ngrx-pokedex.html">Angular - NgrxPokedex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/angular-pwa.html">Angular - PWA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/angular-tricks.html">Angular - Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-console_log.html">JS - console.log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-cypress.html">JS - Cypress</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-import.html">JS - Import</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-method-need-to-know.html">JS - Method you need to know</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-redux.html">JS - Redux Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-trick.html">JS - Trick</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-webpack_from_zero_to_hero.html">JS - Webpack from Zero to Hero</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/js-what_s_new_in_es.html">JS - What s new in ES</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/rxjs-tricks.html">RxJs - Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../js/vue-router_middleware.html">Vue - Router Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/python-venv.html">Python - Venv</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/python-good_practices.html">Python - Good Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/php-best-practices.html">PHP - best-practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/symfony-begining.html">Symfony - First Step</a></li>
<li class="toctree-l1"><a class="reference internal" href="../php/symfony-test.html">Symfony - test</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/ccj_init_project.html">Sphinx - My personnal custo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/travis.html">Sphinx - Travis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uiux/uiux-css_breakpoint.html">UiUx - CSS breakpoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uiux/uiux-design-tricks.html">UiUx - uiux design tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uiux/uiux-less.html">UiUx - LESS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uiux/uiux-skills.html">UIUX - Skills</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conferences/2018-php_tour-montpelier.html">2018 - php tour - montpelier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../draw/draw-apprendre-a-dessiner.html">Apprendre a dessiner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enigma/amazon-software_development_engineer_interview.html">Amazon Software Development Engineer Interview Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enigma/enigma-youtube.html">Enigma</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fantasy/fantasy-kabbale_angel.html">Table de rappel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gogame/gogame-reading.html">Gogame - Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gogame/gogame-teacher.html">Gogame - Teacher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gogame/gogame-teacher-ish.html">Gogame - Teacher - ISH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gogame/gogame-teacher-mdz.html">Gogame - Teacher - MDZ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gogame/gogame-variante.html">Gogame - Variantes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gogame/gogame-youtube.html">Go game - Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-chinese.html">Duolingo - Chinese</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-chinese-voc.html">Duolingo - Chinese - Voc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-german.html">Duolingo - German</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-german-voc.html">Duolingo - German - Voc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-italian.html">Duolingo - Italian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-italian-voc.html">Duolingo - Italian - Voc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolingo-japanese.html">Duolingo - Japanese</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolingo-japanese-voc.html">Duolingo - Japanese</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/duolinguo-letter.html">Duolinguo - letter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../magic/magic-youtube.html">Magic - Youtube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/math-exercise_code.html">Math - Exercise Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mentalism/fabien_olicard-votre_temps_est_infini.html">Fabien Olicard - Votre temps est infini</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mentalism/fabien_olicard-youtube.html">Fabien Olicard - Youtube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mentalism/influence_hypnotique-youtube.html">Influence Hypnotique - Youtube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mentalism/mentalism-other.html">Mentalism - Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="methodology-architecture.html">Methodology - architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="methodology-code-beginner.html">Methodology - Code - Beginner</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Methodology - Event Sourcing and Domain Driven Design (DDD)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cqrs-fonctionnel-event-sourcing-domain-driven-design">CQRS, Fonctionnel, Event Sourcing &amp; Domain Driven Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#some-diff">Some diff</a></li>
<li class="toctree-l3"><a class="reference internal" href="#entity-vs-value-object">entity vs value object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#agregate-root">Agregate root</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-it">Use it</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cqs">CQS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-bus">the bus</a></li>
<li class="toctree-l4"><a class="reference internal" href="#domain-event-business-side-effects">Domain event, business side-effects</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cqrs">CQRS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="methodology-fail_over.html">Methodology - Comment etre sur de rater ton projet informatique</a></li>
<li class="toctree-l1"><a class="reference internal" href="methodology-good_practices.html">Methodology - Code - Good Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="methodology-make_a_readme.html">Methodology - What to write in a README</a></li>
<li class="toctree-l1"><a class="reference internal" href="methodology-parcours_colaborateur.html">Methodology - Parcours colaborateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="methodology-suck_in_programming.html">Methodology - Suck in programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/job-the_good_question.html">Job - The Good Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-libre_et_riche.html">Money - Libre et riche</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-lucbrialy.html">Money - Luc Brialy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-pierre_olivier.html">Money - Pierre Olivier</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-cafe_de_la_bourse.html">Money - Cafe de la Bourse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-central_chart-formation_complete_trading.html">Money - Central Chart - formation complete trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-new_begin_2021.html">Money - New Begin 2021</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-thiami_kabbay-trading_art.html">Money - Thiami Kabbay - Trading art</a></li>
<li class="toctree-l1"><a class="reference internal" href="../money/money-trading.html">Money - Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../music/music-beatbox.html">Music - Beatbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reading/disk_world.html">Reading - Disk World</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipe/recipe-eggs.html">Recipe - Eggs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipe/recipe-pasta.html">Recipe - Pasta</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipe/recipe-full_meal.html">Recipe - Full Meal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../recipe/recipe-vegetables.html">Recipe - Vegetables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quote/quote-main.html">Quote</a></li>
<li class="toctree-l1"><a class="reference internal" href="../60_days_plan.html">Go - 60 days plan</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">my_knowledge</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Methodology - Event Sourcing and Domain Driven Design (DDD)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/methodology/methodology-CQRS_event_sourcing_and_DDD.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="methodology-event-sourcing-and-domain-driven-design-ddd">
<h1>Methodology - Event Sourcing and Domain Driven Design (DDD)<a class="headerlink" href="#methodology-event-sourcing-and-domain-driven-design-ddd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cqrs-fonctionnel-event-sourcing-domain-driven-design">
<h2>CQRS, Fonctionnel, Event Sourcing &amp; Domain Driven Design<a class="headerlink" href="#cqrs-fonctionnel-event-sourcing-domain-driven-design" title="Permalink to this headline">¶</a></h2>
<dl class="field-list simple">
<dt class="field-odd">source</dt>
<dd class="field-odd"><p><a class="reference external" href="https://afup.org/talks/2628-cqrs-fonctionnel-event-sourcing-domain-driven-design">https://afup.org/talks/2628-cqrs-fonctionnel-event-sourcing-domain-driven-design</a></p>
</dd>
</dl>
<p>CQRS: Commad Query Responsability Segregation</p>
<div class="section" id="some-diff">
<h3>Some diff<a class="headerlink" href="#some-diff" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>data-driven: focus on the data and how to manage it
* more or less means CRUD</p>
<blockquote>
<div><ul class="simple">
<li><p>data (mcd)</p>
<ul>
<li><p>Subscription Plan</p></li>
<li><p>Subscription</p></li>
<li><p>Membership</p></li>
<li><p>Session</p></li>
</ul>
</li>
<li><p>then controller
* SubscriptionController
* UserController
* DashboardController
* SessionController</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>but … plu value … as much as an excel</p></li>
</ul>
</li>
<li><p>domain-driven: focus on the behavior, what function do we need
* more or less task based ui</p>
<blockquote>
<div><ul class="simple">
<li><p>Uses cases</p>
<ul>
<li><p>CreateSubscriptionPlan</p></li>
<li><p>Subscribe</p></li>
<li><p>SubscriptionGrossRevenue</p></li>
<li><p>StartSession</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>no need to have all use case to work</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="entity-vs-value-object">
<h3>entity vs value object<a class="headerlink" href="#entity-vs-value-object" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>entity
* has lifecycle
* subscription
* membership
* session</p></li>
<li><p>value object
* has no lifecycle
* DateTime
* Money
* BillingInterval (more business)</p></li>
</ul>
</div>
<div class="section" id="agregate-root">
<h3>Agregate root<a class="headerlink" href="#agregate-root" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>is the main object which permit to manage all the other object
* enforce integrity
* some object have a lifecycle which depend on some other</p>
<blockquote>
<div><ul class="simple">
<li><p>if someone have a subscription, if you remove the guy, the subscription do not need to exist</p></li>
</ul>
</div></blockquote>
</li>
<li><p>query and command</p>
<ul class="simple">
<li><p>command: write, mutation</p>
<ul>
<li><p>need an handler which will to business</p></li>
<li><p>the handler manage only interface</p>
<ul>
<li><p>permit to replace when you want</p></li>
<li><p>constructor -&gt; manage colaborator</p></li>
<li><p>listento -&gt; which class will activate the handle</p></li>
<li><p>handle -&gt; manage business, and return only the id, you need</p></li>
</ul>
</li>
</ul>
</li>
<li><p>query: read</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="use-it">
<h3>Use it<a class="headerlink" href="#use-it" title="Permalink to this headline">¶</a></h3>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">$repository = nez SubscriptionPlanRepository();</span>
<span class="x">$handler = new CreateSubscriptionPlanCommandHandler($repository);</span>
<span class="x">$response = $handler-&gt;handle(</span>
<span class="x">  new CreateSubscriptionPlanCommand(</span>
<span class="x">    &#39;label&#39;, 12, 20, &#39;2018-10-02&#39;, [&#39;gym&#39;, &#39;tennis&#39;]</span>
<span class="x">  )</span>
<span class="x">);</span>

<span class="x">$response-&gt;value();</span>
</pre></div>
</div>
</div>
<div class="section" id="cqs">
<h3>CQS<a class="headerlink" href="#cqs" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Query model
* query
* Handler
* repository
* db</p></li>
<li><p>Command model
* command
* handler
* repository
* db</p></li>
<li><p>but in CQS {repository, db} in query and in command model are the same</p></li>
<li><p>keep id control, use uuid that you control</p></li>
<li><p>repositoryInterface
* add
* get
* delete
* getAll
* find</p></li>
</ul>
<div class="section" id="the-bus">
<h4>the bus<a class="headerlink" href="#the-bus" title="Permalink to this headline">¶</a></h4>
<p>When we need some behavior which are not in the MVP, nor query nor command
* like, performance, login, logging, cache, error, etc
* the bus call middleware</p>
<blockquote>
<div><ul class="simple">
<li><p>middleware</p>
<ul>
<li><p>__construct(CommandBusMiddleware $next, LoggerInterface $logger)</p></li>
<li><p>dispatch(Command $command): CommandResponse</p>
<ul>
<li><p>code before</p></li>
<li><p>then call next operation</p></li>
<li><p>code after</p></li>
</ul>
</li>
</ul>
</li>
<li><p>the dispatcher</p>
<ul>
<li><p>match command and the handler</p></li>
<li><p>__construct(iterator $handlers) { foreach ($handlers as $handler) { $this-&gt;handlers[$handler-&gt;listenTo()] = $handler; } }
* register each handler with its associated command</p></li>
<li><p>dispatch(Command $command): CommandResponse</p></li>
</ul>
</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>then call the dispatcher which call handler</p></li>
<li><p>recuperation of all handler thanks to dependencies injection container of sf</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="dispatcher">
<div class="code-block-caption"><span class="caption-text">dispatcher</span><a class="headerlink" href="#dispatcher" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class CommandBusDispatcher implements CommandBusMiddleware</span>
<span class="x">{</span>
<span class="x">  public function __construct(iterator $handlers) {</span>
<span class="x">    foreach ($handlers as $handler) {</span>
<span class="x">      $this-&gt;handlers[$handler-&gt;listenTo()] = $handler;</span>
<span class="x">    }</span>
<span class="x">  }</span>

<span class="x">  public function dispatch(Command $command): CommandResponse {</span>
<span class="x">    $commandClass = get_class($command);</span>
<span class="x">    $handler = $this-&gt;handlers[$commandClass];</span>
<span class="x">    if ($handler == null) {</span>
<span class="x">      throw new \LogicException(</span>
<span class="x">        &quot;Handler for command $commandClass not found&quot;</span>
<span class="x">      );</span>
<span class="x">    }</span>

<span class="x">    return $handler-&gt;handle($command);</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="commandbusfactory">
<div class="code-block-caption"><span class="caption-text">CommandBusFactory</span><a class="headerlink" href="#commandbusfactory" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">Class CommandBusFactory</span>
<span class="x">{</span>
<span class="x">  static function build(</span>
<span class="x">    iterable $handler,</span>
<span class="x">    Logger $logger</span>
<span class="x">  ): CommandBus {</span>
<span class="x">    return new LoggerBusMiddleWare(</span>
<span class="x">      new CommandBusDispatcher($handler),</span>
<span class="x">      $logger</span>
<span class="x">    );</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="src-kernel-php">
<div class="code-block-caption"><span class="caption-text">src/Kernel.php</span><a class="headerlink" href="#src-kernel-php" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">$container</span>
<span class="x">  -&gt;registerForAutoconfiguration(CommandHandler::class)</span>
<span class="x">  -&gt;addTag(&#39;ddd.command_handler&#39;)</span>
<span class="x">;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="config-services-yaml">
<div class="code-block-caption"><span class="caption-text">config/services.yaml</span><a class="headerlink" href="#config-services-yaml" title="Permalink to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span>services:
    App\Common\Infrastructure\CommandBus:
        factory: &#39;App\Service\CommandBusFactory:build&#39;
        arguments: [!tagged ddd.command_handler, @logger]
        lazy: true
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="controller-example">
<div class="code-block-caption"><span class="caption-text">controller example</span><a class="headerlink" href="#controller-example" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">/**</span>
<span class="x"> * Class PaymentResource</span>
<span class="x"> * @Route(&quot;/plans&quot;)</span>
<span class="x"> */</span>
<span class="x">class PlansResource {</span>
<span class="x">  public function __construct(</span>
<span class="x">    CommandBus $commandBus,</span>
<span class="x">    SerializerInterface $serializer</span>
<span class="x">  ) {</span>
<span class="x">    $this-&gt;commandBus = $commandBus;</span>
<span class="x">    $this-&gt;serializer = $serializer;</span>
<span class="x">  }</span>

<span class="x">  /**</span>
<span class="x">   * @Route(&quot;/&quot;, method={POST})</span>
<span class="x">   */</span>
<span class="x">  public function create(Request $request)</span>
<span class="x">  {</span>
<span class="x">    $command = $this-&gt;serializer-&gt;deserialize(</span>
<span class="x">      $request-&gt;getContent(),</span>
<span class="x">      CreateSubscriptionPlanCommand::class,</span>
<span class="x">      &#39;json&#39;</span>
<span class="x">    );</span>

<span class="x">    $response = $this-&gt;commandBus-&gt;dispatch($command);</span>

<span class="x">    return Response::create($response-&gt;value(), 201);</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="doctrinefluchmiddleware">
<div class="code-block-caption"><span class="caption-text">DoctrineFluchMiddleware</span><a class="headerlink" href="#doctrinefluchmiddleware" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class DoctrineFluchMiddleware</span>
<span class="x">{</span>
<span class="x">  function __construct(CommandBus $next, EntityManager $em)</span>
<span class="x">  {</span>
<span class="x">    $this-&gt;next = $next;</span>
<span class="x">    $this-&gt;em = $em;</span>
<span class="x">  }</span>

<span class="x">  function dispatch(Command $command): CommandResponse</span>
<span class="x">  {</span>
<span class="x">    $this-em-&gt;getConnection()-&gt;beginTransaction();</span>
<span class="x">    try {</span>
<span class="x">      $commandResponse = $this-&gt;next-&gt;dispatch($command);</span>
<span class="x">      $this-&gt;em-&gt;flush();</span>
<span class="x">      $this-&gt;em-&gt;getConnection-&gt;commit();</span>
<span class="x">    } catch() {</span>
<span class="x">      $this-&gt;em-&gt;rollback();</span>
<span class="x">    }</span>
<span class="x">    return $commandResponse;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="domain-event-business-side-effects">
<h4>Domain event, business side-effects<a class="headerlink" href="#domain-event-business-side-effects" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">event</span></code> are used for all that is not business nor technic needed
* <code class="code docutils literal notranslate"><span class="pre">event</span></code> happened in an other process if it fail it will not affect the <code class="code docutils literal notranslate"><span class="pre">command</span></code>
* a <code class="code docutils literal notranslate"><span class="pre">command</span></code> present a intent, a <code class="code docutils literal notranslate"><span class="pre">event</span></code> present a fact
* an <code class="code docutils literal notranslate"><span class="pre">eventHandler</span></code> always return void
* example1: in a user subscribe, send a mail to confirm
* example2: in event sourcing, when you realise a command, update the view database
* example3: update a legacy db
* example4: make stats and stock it</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="event-example">
<div class="code-block-caption"><span class="caption-text">event example</span><a class="headerlink" href="#event-example" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">namespace App\Membership\Domain;</span>

<span class="x">class MemberJoined implement Event</span>
<span class="x">{</span>
<span class="x">  public $newMemberId;</span>
<span class="x">  public $chosenPlanId;</span>

<span class="x">  public __construct(Uuid $newMemberId, Uuid $chosenPlanId)</span>
<span class="x">  {</span>
<span class="x">    $this-&gt;newMemberId = $newMemberId;</span>
<span class="x">    $this-&gt;chosenPlanId = $chosenPlanId;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="handler">
<div class="code-block-caption"><span class="caption-text">handler</span><a class="headerlink" href="#handler" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class JoinMembershipCommandHandler implements CommandHandler</span>
<span class="x">{</span>
<span class="x">  public function handle(Command $command): CommandResponse</span>
<span class="x">  {</span>
<span class="x">    /* ... */</span>
<span class="x">    return CommandResponse::withValue(</span>
<span class="x">      $membership-&gt;id(),</span>
<span class="x">      new MemberJoined($membership-&gt;id(), $plan-&gt;id())</span>
<span class="x">    );</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<p>Withvalue signature
<code class="code docutils literal notranslate"><span class="pre">static</span> <span class="pre">function</span> <span class="pre">withValue($value,</span> <span class="pre">Event...</span> <span class="pre">$events):</span> <span class="pre">CommandResponse</span></code></p>
<div class="literal-block-wrapper docutils container" id="event-handler">
<div class="code-block-caption"><span class="caption-text">event handler</span><a class="headerlink" href="#event-handler" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class SendWelcomeMailOnMemberJoined implements EventHandler</span>
<span class="x">{</span>
<span class="x">  public function __construct(</span>
<span class="x">    Mailer $mailer,</span>
<span class="x">    SubscriptionPlanRepository $planRepository,</span>
<span class="x">    MemberRepository $memberRepository</span>
<span class="x">  ) { /* ... */ }</span>

<span class="x">  public function handle(MemberJoined $event): void</span>
<span class="x">  {</span>
<span class="x">    $member = $this-&gt;memberRepository-&gt;get($event-&gt;memberId);</span>
<span class="x">    $plan = $this-&gt;memberRepository-&gt;get($event-&gt;choosenPlanId);</span>

<span class="x">    $message = &quot;Hello .$member-&gt;firstname(), welcome in SportLand We hope you&#39;ll ennjoy your $plan-&gt;name() subscription&quot;;</span>

<span class="x">    $mailer-&gt;send($member-&gt;email(), $message);</span>
<span class="x">  }</span>

<span class="x">  public function listenTo(): string</span>
<span class="x">  {</span>
<span class="x">    return MemberJoined::class;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="event-dispatcher-middleware">
<div class="code-block-caption"><span class="caption-text">event dispatcher middleware</span><a class="headerlink" href="#event-dispatcher-middleware" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class EventDispatcherBusMiddleware implements CommandBusMiddleware</span>
<span class="x">{</span>
<span class="x">  public function __construct(CommandBus $next, EventBus $eventBus)</span>
<span class="x">  { /* ... */ }</span>

<span class="x">  public function dispatch(Command $command): CommandResponse</span>
<span class="x">  {</span>
<span class="x">    $commandResponse = $this-&gt;bus-&gt;dispatch($command);</span>
<span class="x">    if ($commandResponse-&gt;hasEvents()) {</span>
<span class="x">      foreach ($commandResponse-&gt;events() as $event) {</span>
<span class="x">        $this-&gt;eventBus-&gt;dispatch($event);</span>
<span class="x">      }</span>
<span class="x">    }</span>
<span class="x">    return $commandResponse;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="event-dispatcher">
<div class="code-block-caption"><span class="caption-text">event dispatcher</span><a class="headerlink" href="#event-dispatcher" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class EventBus implements \App\Common\DDD\EventBus</span>
<span class="x">{</span>
<span class="x">  public function __construct(iterable $handlers)</span>
<span class="x">  {</span>
<span class="x">    foreach ($handlers as $handler) {</span>
<span class="x">      $this-&gt;handlers[] = $handler;</span>
<span class="x">    }</span>
<span class="x">  }</span>

<span class="x">  public function dispatch(Event $event):void</span>
<span class="x">  {</span>
<span class="x">    $eventClass = get_class($event);</span>
<span class="x">    $matchingHandlers = array_filter(</span>
<span class="x">      $this-&gt;handlers,</span>
<span class="x">      function($handler) use ($eventClass) {</span>
<span class="x">        return $handler-&gt;listenTo() === $eventClass;</span>
<span class="x">      }</span>
<span class="x">    )</span>

<span class="x">    foreach ($matchingHandlers as $handler) {</span>
<span class="x">      $handler-&gt;handle($event);</span>
<span class="x">    }</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cqrs">
<h4>CQRS<a class="headerlink" href="#cqrs" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>repository have now only <code class="code docutils literal notranslate"><span class="pre">get</span></code>, <code class="code docutils literal notranslate"><span class="pre">add</span></code>, <code class="code docutils literal notranslate"><span class="pre">delete</span></code></p></li>
<li><p>not need repository in <code class="code docutils literal notranslate"><span class="pre">query</span> <span class="pre">model</span></code>, it is free for all</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="exemple-repository-implements-with-doctrine">
<div class="code-block-caption"><span class="caption-text">exemple repository, implements with doctrine</span><a class="headerlink" href="#exemple-repository-implements-with-doctrine" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class BasketDoctrine implements Repository</span>
<span class="x">{</span>
<span class="x">  public function __construct(EntityManagerInterface $em)</span>
<span class="x">  {</span>
<span class="x">    $this-&gt;em = $em;</span>
<span class="x">  }</span>

<span class="x">  public function get(Uuid $uuid): Basket</span>
<span class="x">  {</span>
<span class="x">    $data = $this-&gt;em</span>
<span class="x">      -&gt;getRepository(Basket::class)</span>
<span class="x">      -&gt;find($uuid)</span>
<span class="x">    ;</span>
<span class="x">    if ($data === null) {</span>
<span class="x">      throw new EntityNotFoundException();</span>
<span class="x">    }</span>

<span class="x">    return Basket::mapFromDoctrine($data);</span>
<span class="x">  }</span>

<span class="x">  public function add(Basket $data): void</span>
<span class="x">  {</span>
<span class="x">    $this-&gt;em-&gt;merge(Basket::mapFromPayment($data));</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="query-handler">
<div class="code-block-caption"><span class="caption-text">query handler</span><a class="headerlink" href="#query-handler" title="Permalink to this code">¶</a></div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class FindActiveSubscriptionPlansQueryHandler</span>
<span class="x">{</span>
<span class="x">  private $connection;</span>

<span class="x">  public function __construct(EntityManagerInterface $em)</span>
<span class="x">  {</span>
<span class="x">    $this-&gt;em = $em;</span>
<span class="x">  }</span>

<span class="x">  public function handle(Query $query): array {</span>
<span class="x">    $query = $this-&gt;em-&gt;query(&quot;SELECT NEW SubscriptionViewModel(s.name, s.prive) FROM Subscription s&quot;);</span>
<span class="x">    return $query-&gt;getResult();</span>
<span class="x">  }</span>

<span class="x">  public function listenTo(): string {</span>
<span class="x">    return FindAllActiveSubscriptionPlansQuery::class;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</div>
<p><a class="reference external" href="http://blog.arkency.com/2016/05/the-anatomy-of-domain-event/">http://blog.arkency.com/2016/05/the-anatomy-of-domain-event/</a>
<a class="reference external" href="https://www.youtube.com/watch?v=QGGZs0KqxZw">https://www.youtube.com/watch?v=QGGZs0KqxZw</a></p>
<ul class="simple">
<li><p><a class="reference external" href="https://dev.to/patrykwozinski/symfony-messenger-component-for-cqrs-applications-884">https://dev.to/patrykwozinski/symfony-messenger-component-for-cqrs-applications-884</a></p></li>
<li><p><a class="reference external" href="https://github.com/CodelyTV/php-ddd-example/tree/master/src/Shared">https://github.com/CodelyTV/php-ddd-example/tree/master/src/Shared</a></p></li>
<li><p><a class="reference external" href="https://github.com/jorge07/symfony-5-es-cqrs-boilerplate/blob/symfony-5/src/UI/Http/Web/Controller/HomeController.php">https://github.com/jorge07/symfony-5-es-cqrs-boilerplate/blob/symfony-5/src/UI/Http/Web/Controller/HomeController.php</a></p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="methodology-fail_over.html" class="btn btn-neutral float-right" title="Methodology - Comment etre sur de rater ton projet informatique" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="methodology-code-beginner.html" class="btn btn-neutral float-left" title="Methodology - Code - Beginner" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, ccj

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>